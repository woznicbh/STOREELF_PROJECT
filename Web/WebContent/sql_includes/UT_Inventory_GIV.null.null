 WITH item_dt as (SELECT * FROM gv_admin.yfs_item WHERE item_id = '?'),      item_inv_dt      AS (SELECT invit.inventory_item_key,                 item.item_id,                 item.short_description            FROM gv_admin.yfs_inventory_item invit, item_dt item           WHERE invit.item_id = item.item_id),      store_nodes      AS (SELECT n.shipnode_key            FROM sterling.yfs_ship_node@OMS n           WHERE n.node_type = 'STORE'),      sup_dt      AS (SELECT s.*            FROM gv_admin.yfs_inventory_supply s, store_nodes sn           WHERE s.supply_type = 'ONHAND' AND s.SHIPNODE_KEY = sn.shipnode_key),      dem_dt      AS (SELECT d.*            FROM gv_admin.yfs_inventory_demand d, store_nodes sn           WHERE (demand_type = 'ALLOCATED' OR demand_type = 'RESERVED')                 AND d.shipnode_key = sn.shipnode_key), supply As( SELECT i.ITEM_ID,        i.SHORT_DESCRIPTION,        'SUPPLY' AS INV_TYPE,        DECODE (TRIM (s.shipnode_key), NULL, ' ', TRIM (s.shipnode_key))           SHIPNODE_KEY,        NVL (SUM (s.QUANTITY), '0.0') AS QUANTITY   FROM sup_dt s, item_inv_dt i  WHERE i.inventory_item_key = s.INVENTORY_ITEM_KEY(+) GROUP BY i.ITEM_ID,          i.SHORT_DESCRIPTION,          'SUPPLY',          DECODE (TRIM (s.shipnode_key), NULL, ' ', TRIM (s.shipnode_key))          ), demand AS ( SELECT i.ITEM_ID,        i.SHORT_DESCRIPTION,        'DEMAND' AS INV_TYPE,        DECODE (TRIM (s.shipnode_key), NULL, ' ', TRIM (s.shipnode_key))           SHIPNODE_KEY,        NVL (SUM (s.QUANTITY), '0.0') AS QUANTITY   FROM dem_dt s, item_inv_dt i  WHERE i.inventory_item_key = s.INVENTORY_ITEM_KEY(+) GROUP BY i.ITEM_ID,          i.SHORT_DESCRIPTION,          'DEMAND',          DECODE (TRIM (s.shipnode_key), NULL, ' ', TRIM (s.shipnode_key))          ) select supply.item_id, supply.short_description, supply.shipnode_key, supply.quantity as SUPPLY, NVL(demand.quantity, 0) as DEMAND from supply LEFT OUTER JOIN demand on supply.shipnode_key = demand.shipnode_key  order by supply.shipnode_key