SELECT dt.*,														       dt.active + dt.CASE + dt.trans + dt.carton alloc_total,           dt.unalloc_case + dt.unalloc_trans unalloc_total             FROM (WITH skulist                                                AS (SELECT im.item_name AS sku_id,                                im.description AS sku_desc,                            CASE                                                      WHEN iw.convey_flag = '1'                                   AND iwm.dflt_wave_proc_type <> '9'                THEN                                                      'SORT'                                              WHEN iw.convey_flag = '2'                                   AND iwm.dflt_wave_proc_type <> '9'                THEN                                                      'NON-SORT'                                          WHEN iw.convey_flag = '2'                                   AND iwm.dflt_wave_proc_type = '9'                 THEN                                                      'SHIP_ALONE'                                        WHEN iw.convey_flag = '3'                              THEN                                                      'CAGE'                                           END                                                       AS sku_type                                    FROM wmos_efc.item_cbo im,                                  wmos_efc.item_facility_mapping_wms iwm,                wmos_efc.item_wms iw                             WHERE     im.item_id = iwm.item_id                 AND im.item_id = iw.item_id                  AND im.item_name = ' ' ?' '),    wmactive                                                AS (SELECT ic.item_name AS sku_id,                                 SUM (pld.on_hand_qty) AS active_inventory          FROM wmos_efc.wm_inventory pld,                              msf_efc.locn_hdr lh,                                    wmos_efc.item_cbo ic                              WHERE     pld.location_id = lh.locn_id                        AND pld.item_id = ic.item_id                            AND lh.locn_class IN ('A', 'C')                  GROUP BY ic.item_name),                             wmcase                                                  AS (SELECT ic.item_name AS sku_id,                      SUM (cd.size_value) AS case_inventory             FROM wmos_efc.lpn_detail cd,                                wmos_efc.lpn ch,                                       wmos_efc.item_cbo ic                             WHERE     ch.lpn_id = cd.lpn_id                   AND cd.item_id = ic.item_id                 AND ch.lpn_facility_status >= 10            AND ch.lpn_facility_status < 90             AND ch.inbound_outbound_indicator = 'I'     AND cd.size_value > 0                       AND NOT EXISTS                             (SELECT lpn_id                       FROM    wmos_efc.lpn_lock cl           JOIN                                 wmos_efc.sys_code sc           ON sc.code_id = cl.inventory_lock_code          AND sc.rec_type = 'B'                        AND sc.code_type = '527'                     AND (sc.misc_flags IS NULL           OR SUBSTR (sc.misc_flags,                  2,                              1) IN                      ('N', ' '))                                 WHERE cl.lpn_id = cd.lpn_id)                    GROUP BY ic.item_name),                                                  wmtrans                                                          AS (SELECT ic.item_name AS sku_id,                                                  SUM (ti.on_hand_qty) AS trans_inventory                         FROM wmos_efc.wm_inventory ti, wmos_efc.item_cbo ic                 WHERE ic.item_id = ti.item_id                                             AND transitional_inventory_type is not null                    GROUP BY ic.item_name),                                                                                                               wmcarton                                                             AS (SELECT ic.item_name AS sku_id,                                              SUM (ld.size_value) AS carton_inventory                         FROM wmos_efc.item_cbo ic,                                                   wmos_efc.lpn l                                                    INNER JOIN                                                              wmos_efc.lpn_detail ld                                            ON ld.lpn_id = l.lpn_id                                        WHERE     l.lpn_facility_status < 90                                       AND l.inbound_outbound_indicator = 'O'                               AND ic.item_id = ld.item_id                                   GROUP BY ic.item_name),                                          wmunalloccase                                                        AS (SELECT sku_id, qty_not_alloc AS unalloccase_inventory         FROM (SELECT ic.item_name AS sku_id,                                     SUM (                                                          (ld.size_value                                               - (CASE                                                           WHEN X.CASE_NBR IS NOT NULL                                 THEN                                                           X.QTY_NOT_ALLOC                                          ELSE                                                           0                                                     END)))                                                  AS QTY_NOT_ALLOC                                    FROM wmos_efc.item_cbo ic,                                 wmos_efc.lpn l                               INNER JOIN                                         wmos_efc.lpn_detail ld                       ON l.lpn_id = ld.lpn_id                     LEFT OUTER JOIN                                   (SELECT CASE_NBR, SKU_ID, QTY_NOT_ALLOC           FROM (SELECT l.lpn_id AS CASE_NBR,                          ic.item_name AS SKU_ID,                        SUM (                                             aid.QTY_ALLOC                                  - aid.QTY_PULLD)                               AS QTY_NOT_ALLOC          FROM wmos_efc.item_cbo ic,             wmos_efc.lpn_detail ld,              wmos_efc.lpn l                 INNER JOIN                           wmos_efc.ALLOC_INVN_DTL aid          ON l.tc_lpn_id =                              aid.CNTR_NBR                         AND aid.STAT_CODE < 90                  AND EXISTS                                     (SELECT 1                                  FROM wmos_efc.INVN_NEED_TYPE int                     WHERE int.TASK_CMPL_CORR_UPD IN                                (2, 6)                                             AND int.INVN_NEED_TYPE =                                     aid.INVN_NEED_TYPE                             AND int.WHSE =                                               aid.WHSE)              WHERE l.lpn_facility_status IN               (45, 50, 64)                     AND l.lpn_id = ld.lpn_id            AND ld.item_id =                           ic.item_id             GROUP BY l.lpn_id, ic.item_name)      UNION ALL                                     SELECT CASE_NBR, SKU_ID, QTY_NOT_ALLOC          FROM (SELECT l.lpn_id AS CASE_NBR,                         ic.item_name AS SKU_ID,                       SUM (                                            td.QTY_ALLOC                                  - td.QTY_PULLD)                               AS QTY_NOT_ALLOC                      FROM wmos_efc.item_cbo ic,                         wmos_efc.lpn_detail ld,                             wmos_efc.lpn l                             INNER JOIN                                       wmos_efc.TASK_DTL td                       ON l.tc_lpn_id =                                    td.CNTR_NBR                          INNER JOIN                                       wmos_efc.TASK_HDR th                       ON td.TASK_ID = th.TASK_ID                       AND th.STAT_CODE < 90                         AND EXISTS                        (SELECT 1                     FROM wmos_efc.INVN_NEED_TYPE int            WHERE int.TASK_CMPL_CORR_UPD IN                       (2, 6)                                    AND int.INVN_NEED_TYPE =                            th.INVN_NEED_TYPE                     AND int.WHSE =                                      th.WHSE)   WHERE l.lpn_facility_status IN                     (45, 50, 64)                           AND ic.item_id =                                 ld.item_id                         AND ld.lpn_id = l.lpn_id             GROUP BY l.lpn_id, ic.item_name)) X         ON ld.lpn_id = X.CASE_NBR                                WHERE     l.lpn_facility_status >= 10                        AND l.lpn_facility_status < 90                         AND ld.item_id = ic.item_id                            AND l.inbound_outbound_indicator = 'I'                 AND EXISTS                                              (SELECT 1                                           FROM wmos_efc.lpn l                                   INNER JOIN (SELECT ll.lpn_id                                           AS CASE_NBR                              FROM    wmos_efc.lpn_lock ll                               INNER JOIN                                               msf_efc.SYS_CODE sc                                ON ll.INVENTORY_LOCK_CODE =                                     sc.CODE_ID                                  WHERE sc.REC_TYPE =                                              'B'                                                  AND sc.CODE_TYPE =                                             '527'                                            AND (SUBSTR (                                                   sc.MISC_FLAGS,                                          2,                                                      1) =                                                    'N'                                                  OR sc.MISC_FLAGS                                              IS NULL                                           OR SUBSTR (                                                   sc.MISC_FLAGS,                                          2,                                               1) =                                             ' ')                           GROUP BY ll.lpn_id) MV5                 ON l.lpn_id = MV5.CASE_NBR                    INNER JOIN wmos_efc.lpn_detail Y                    ON l.lpn_id = Y.lpn_id                  WHERE l.lpn_facility_status >= 10                      AND l.lpn_facility_status < 90                   AND ld.lpn_id = Y.lpn_id)                GROUP BY ic.item_name)),   wmunalloctrans                                                   AS (SELECT ic.item_name AS sku_id,                                          SUM (wi.on_hand_qty) AS unalloctrans_inventory              FROM wmos_efc.wm_inventory wi,                                        wmos_efc.item_cbo ic,                                            msf_efc.sys_code sc                                        WHERE     wi.item_id = ic.item_id                                      AND wi.transitional_inventory_type = sc.code_id                  AND sc.rec_type = 'B'                                            AND sc.code_type = '052'                                         AND (sc.misc_flags IS NULL                                            OR SUBSTR (sc.misc_flags, 3, 1) IN ('N', ' '))       GROUP BY ic.item_name)                      SELECT TRIM (sku_id) item_id,                               TRIM (sku_desc) item_description,                    NVL(sku_type, ' ') item_type,                        COALESCE ( (SELECT active_inventory                                FROM wmactive                                       WHERE sku_id = skulist.sku_id),                   0)                                            AS ACTIVE,                                        COALESCE ( (SELECT case_inventory                                  FROM wmcase                                         WHERE sku_id = skulist.sku_id),                   0)                                            AS CASE,                                          COALESCE ( (SELECT trans_inventory                                 FROM wmtrans                                        WHERE sku_id = skulist.sku_id),                   0)                                            AS TRANS,                                         COALESCE ( (SELECT carton_inventory                                FROM wmcarton                                       WHERE sku_id = skulist.sku_id),                   0)                                            AS CARTON,                                        COALESCE ( (SELECT unalloccase_inventory                           FROM wmunalloccase                                  WHERE sku_id = skulist.sku_id),                   0)                                            AS UNALLOC_CASE,                                  COALESCE ( (SELECT unalloctrans_inventory                          FROM wmunalloctrans                                 WHERE sku_id = skulist.sku_id),                   0)                                            AS UNALLOC_TRANS       FROM skulist                 ORDER BY Sku_Id) Dt           